This is adapted for my purposes from https://github.com/stapelberg/regelwerk
